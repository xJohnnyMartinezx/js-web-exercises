<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>MapBox API</title>

        <script src='https://api.mapbox.com/mapbox-gl-js/v2.13.0/mapbox-gl.js'></script>
        <link href='https://api.mapbox.com/mapbox-gl-js/v2.13.0/mapbox-gl.css' rel='stylesheet' />

    </head>
    <body>
<!--    ******* USER SEARCH BOX *********-->
    <label for="user-search">Search for a location</label>
    <input type="text" id="user-search">
        <button id="sub-butt" type="button">submit</button>

<!--    ******* USER ZOOM *********-->
        <label for="user-zoom">Choose a zoom level:</label>
        <select name="zoom-level" id="user-zoom" onchange="userZoom()">
            <option id="user-zoom-5" value="5">5</option>
            <option id="user-zoom-15" value="15">15</option>
            <option id="user-zoom-20" value="20">20</option>
        </select>

<!--    ******* HIDE/SHOW MARKERS BUTTON *********-->
    <button id="hide-marker" type="button">Hide Markers</button>


    <!--MAPBOX-->

        <div id='map' style='width: 1000px; height: 600px;'></div>
        <script src = "js/keys.js"></script>
        <script src = "js/mapbox-geocoder.js"></script>
        <script>

            let favRest = [
                           {
                               "name": "BarrelHouse 101",
                               "address" : "545 E Thompson Blvd, Ventura, CA 93001",
                               "coordinates" : ["-119.29219428230779", "34.27869764212124"],
                               "image" : "https://lh5.googleusercontent.com/p/AF1QipNkEW4Zq0OIrDZSVcidu5NG1hdZeGubIWlHMIA-=w408-h272-k-no"
                           },
                           {
                               "name": "Corrales Mexican Food",
                               "address" : "301 E Main St, Ventura, CA 93001",
                               "coordinates" : ["-119.2881414549982", "34.27860883389299"],
                               "image" : "https://lh5.googleusercontent.com/p/AF1QipOrjiazWGkp-kMphXZsG7hdjzIHTwXe71Yq9QMY=w408-h544-k-no"
                           },
                           {
                               "name": "Cajun Kitchen Cafe",
                               "address" : "545 E Thompson Blvd, Ventura, CA 93001",
                               "coordinates" : ["-119.29540487659114","34.281073359398704"],
                               "image" : "https://lh5.googleusercontent.com/p/AF1QipMHqxksb0tMDeW3tNPNYwtZ-8pS_LSAbm1MMfGn=w408-h306-k-no"
                           }
            ]


            // ***** LINES 53-62 ARE WHAT ACTUALLY SET THE MAP ON THE PAGE.********
            mapboxgl.accessToken = MAPBOX;
            const map = new mapboxgl.Map({
                // vvv SETTING THE MAP INSIDE THE <DIV> CONTAINER WITH THE ID OF "map" (LINE 31)
                container: 'map', // container ID
        // Choose from Mapbox's core styles, or make your own style with Mapbox Studio
                style: 'mapbox://styles/mapbox/streets-v12', // style URL
                // vvv STARTING POSITION OF THE MAP (GETS OVERRIDEN BY GEOCODER (LINE 72-79) IF DESIGNATED)
                center: [-74.5, 40], // starting position [lng, lat]
                zoom: 20 // starting zoom
            });


            // GEOCODING SPECIFIC LOCATION
            let currentLocation = geocode("Ventura", MAPBOX)
            console.log(currentLocation);

            currentLocation.then(function (results){
                console.log(results);
                map.setCenter([results[0], results[1]]);
                map.setZoom(15);
            })

            // FOREACH TO LOOP THROUGH favRest ARRAY TO ACCESS DATA IN favRest ARRAY. USING "dataItem" AS FUNCTION PARAM.
            favRest.forEach(function (dataItem){
                // **** ^^^ CAN ALSO BE WRITTEN LIKE : favRest.forEach((dataItem) => {
                // console.log(dataItem.name);
                // console.log(dataItem.address);
                // console.log(dataItem.coordinates);

                var name = dataItem.name;
                var address = dataItem.address;
                var photo = dataItem.image;

                let marker = new mapboxgl.Marker()
                    .setLngLat([dataItem.coordinates[0], dataItem.coordinates[1]],)
                    .addTo(map);

                  // SETTING A POPUP
                let popup = new mapboxgl.Popup()
                    // GIVING POPUP OBJECT A LOCATION
                    .setLngLat([dataItem.coordinates[0], dataItem.coordinates[1]])
                    // GIVING THE POPUP A MESSAGE
                    .setHTML("<h1>" + name + "</h1>" +
                            "<h3>" + address + "</h3>" +
                       " <img src='" + photo + "' alt='rest image' style='width: 200px; height: 150px'/>")
                // HIDES THE POPUP WHEN CLICK OUTSIDE OF IT. (***HAS TO BE PLACED ABOVE setPopup()***)
                marker.togglePopup(popup);
                // SETS POPUP WHEN MARKER IS CLICKED ON
                // CHAINING setPopup() TO "marker" VARIABLE ON LINE 92 MAKES THE "POPUP" POPUP WHEN THE MARKER IS CLICKED.
                marker.setPopup(popup)
                // HIDES THE MARKERS WHEN "HIDE MARKERS" BUTTON IS CLICKED
                document.getElementById('hide-marker').addEventListener("click", function () {
                    marker.remove();

                })

            })

            //     USER DEFINED SEARCH

            document.getElementById('sub-butt').addEventListener("click", function () {
                let currentUserSearch = geocode(document.getElementById("user-search").value, MAPBOX)
                console.log(currentUserSearch);

                // SETTING MAP CENTER
                currentUserSearch.then(function (results){
                    console.log(results);
                    map.setCenter([results[0], results[1]]);
                    // SETTING MARKER
                    let marker = new mapboxgl.Marker()
                        .setLngLat([results[0], results[1]])
                        .addTo(map);
                    // SETTING POPUP
                    let popup = new mapboxgl.Popup()
                        .setLngLat([results[0], results[1]])
                        .setHTML("<h1>" + document.getElementById("user-search").value + "</h1>")
                    marker.togglePopup(popup);
                    marker.setPopup(popup);

                    document.getElementById('hide-show-marker').addEventListener("click", function () {
                        marker.remove();

                    })


                })
            })

        //     USER SELECTED ZOOM LEVEL
            function userZoom() {
                // TARGETING <select> TAG/ELEMENT BY ITS ID OF "user-zoom"
                // AND RETRIEVING THE VALUE OF WHAT THE USER SELECTS. (.value)
                let userSelection = document.getElementById("user-zoom").value;
                console.log(userSelection);
                // COMPARING USER SELECTION AND SETTING MAP ZOOM VALUE
                if (userSelection === "5"){
                    map.setZoom(5);
                } else if (userSelection === "15"){
                    map.setZoom(15);
                } else if (userSelection === "20"){
                    map.setZoom(20);
                }
            }

        </script>
        <script src="https://code.jquery.com/jquery-3.6.4.min.js"
                integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8="
                crossorigin="anonymous"></script>
    </body>
</html>